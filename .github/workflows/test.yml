name: Code Analysis

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  analyze:
    runs-on: self-hosted

    steps:
      - uses: actions/checkout@v4
        with:
          clean: false

      # ---- C / C++ ----
      - name: Analyze C/C++
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Include *.c,*.cpp -ErrorAction SilentlyContinue
          if ($files) {
            clang-tidy $files.FullName --quiet
          } else {
            echo "No C/C++ files found"
          }

      # ---- CMake ----
      - name: Analyze CMake
        shell: pwsh
        run: |
          if (Test-Path "CMakeLists.txt") {
            cmakelint CMakeLists.txt
          } else {
            echo "No CMake files"
          }

      # ---- Dart ----
      - name: Analyze Dart
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Include *.dart -ErrorAction SilentlyContinue
          if ($files) {
            dart analyze
          } else {
            echo "No Dart files"
          }

      # ---- HTML ----
      - name: Analyze HTML
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Include *.html -ErrorAction SilentlyContinue
          if ($files) {
            htmlhint "**/*.html"
          } else {
            echo "No HTML files"
          }

      # ---- Swift (best effort) ----
      - name: Analyze Swift
        shell: pwsh
        continue-on-error: true
        run: |
          $files = Get-ChildItem -Recurse -Include *.swift -ErrorAction SilentlyContinue
          if ($files) {
            echo "Swift files detected (analysis limited on Windows)"
          } else {
            echo "No Swift files"
          }
